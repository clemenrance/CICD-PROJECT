pipeline{

     agent any

     stages{

          stage('git checkout'){

               steps{
                   git branch: 'main', url: 'https://github.com/clemenrance/CICD-PROJECT.git'
               }
            }   
          stage('unit testig'){

               steps{
                   sh 'mvn test'
               }     
          }
          stage('integration testing'){

               steps{
                   sh 'mvn verify -DskiUnitTests'
               }     
          }
          stage('maven Build'){

               steps{
                   sh 'mvn clean install'
               }     
          }
          stage('Static Test Analysis in sonarqube'){

               steps{
                   script{
                    withSonarQubeEnv(credentialsId: 'sonarqube-api-key') {
                      sh 'mvn clean package sonar:sonar'
                   }
               }     
           }
         }
         stage('Quality Gate Analysis'){

               steps{
                   script{
                    waitForQualityGate abortPipeline: false, credentialsId: 'sonarqube-api-key'
                }
            }
         }
    }
}  
